(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function s(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(o){if(o.ep)return;o.ep=!0;const c=s(o);fetch(o.href,c)}})();const e={currentView:"mainMenu",selectedIndex:0,viewHistory:[],isPlaying:!1,currentSong:{title:"Across the River, Into the Trees",artist:"Artist Name",album:"Album Name",duration:225,currentTime:0}},y={mainMenu:{id:"mainMenu",listId:"mainMenuList",title:"Music",hasBack:!1},songsView:{id:"songsView",listId:"songsList",title:"Songs",hasBack:!0},albumsView:{id:"albumsView",listId:"albumsList",title:"Albums",hasBack:!0},nowPlayingView:{id:"nowPlayingView",listId:null,title:"Now Playing",hasBack:!0}};let g,a,l=null;function p(){console.log("iPod Interface initializing..."),g=document.getElementById("headerTitle"),a=document.getElementById("backIndicator"),x(),k(),r("mainMenu"),console.log("iPod Interface ready!"),console.log("Controls: Scroll wheel to navigate, PTT button to select")}function r(t,n=!1){const s=y[t];if(!s){console.error("View not found:",t);return}n&&e.currentView&&e.viewHistory.push({view:e.currentView,selectedIndex:e.selectedIndex}),document.querySelectorAll(".view-container").forEach(o=>{o.classList.add("hidden")});const i=document.getElementById(s.id);i&&(i.classList.remove("hidden"),i.classList.add("fade-in")),g.textContent=s.title,s.hasBack&&e.viewHistory.length>0?a.classList.add("visible"):a.classList.remove("visible"),e.currentView=t,e.selectedIndex=0,s.listId?(l=document.getElementById(s.listId),u()):l=null,console.log("Switched to view:",t)}function m(){if(e.viewHistory.length===0){console.log("No history to go back to");return}const t=e.viewHistory.pop();e.selectedIndex=t.selectedIndex,r(t.view,!1),l&&f()}function u(){if(!l)return;const t=l.querySelectorAll(".list-item");t.forEach(n=>n.classList.remove("selected")),t[e.selectedIndex]&&(t[e.selectedIndex].classList.add("selected"),f())}function f(){if(!l)return;const n=l.querySelectorAll(".list-item")[e.selectedIndex];n&&n.scrollIntoView({behavior:"smooth",block:"nearest"})}function b(){if(!l)return;const n=l.querySelectorAll(".list-item").length;n!==0&&(e.selectedIndex=(e.selectedIndex-1+n)%n,u(),console.log("Selected index:",e.selectedIndex))}function I(){if(!l)return;const n=l.querySelectorAll(".list-item").length;n!==0&&(e.selectedIndex=(e.selectedIndex+1)%n,u(),console.log("Selected index:",e.selectedIndex))}function h(){switch(console.log("Confirm selection:",e.currentView,e.selectedIndex),e.currentView){case"mainMenu":S();break;case"songsView":v();break;case"albumsView":P();break;case"nowPlayingView":E();break;default:console.log("No action defined for this view")}}function S(){const n=["playlists","artists","albums","songs","genres","nowPlaying"][e.selectedIndex];switch(console.log("Main menu selection:",n),n){case"songs":r("songsView",!0);break;case"albums":r("albumsView",!0);break;case"nowPlaying":r("nowPlayingView",!0);break;default:console.log("View not yet implemented:",n)}}function v(){const s=document.getElementById("songsList").querySelectorAll(".list-item")[e.selectedIndex];if(s){const i=s.querySelector(".item-text").textContent;console.log("Selected song:",i),e.currentSong.title=i,e.currentSong.artist="Artist Name",e.currentSong.album="Album Name",e.isPlaying=!0,w(),r("nowPlayingView",!0)}}function P(){const s=document.getElementById("albumsList").querySelectorAll(".list-item")[e.selectedIndex];if(s){const i=s.querySelector(".item-text").textContent;console.log("Selected album:",i)}}function E(){L()}function w(){document.getElementById("songTitle").textContent=e.currentSong.title,document.getElementById("songArtist").textContent=e.currentSong.artist,document.getElementById("songAlbum").textContent=e.currentSong.album;const t=document.getElementById("playPauseBtn");t.textContent=e.isPlaying?"⏸":"▶"}function L(){e.isPlaying=!e.isPlaying;const t=document.getElementById("playPauseBtn");t.textContent=e.isPlaying?"⏸":"▶",console.log("Playback state:",e.isPlaying?"Playing":"Paused")}function x(){window.addEventListener("scrollUp",()=>{console.log("Scroll wheel: Up"),l&&b()}),window.addEventListener("scrollDown",()=>{console.log("Scroll wheel: Down"),l&&I()}),window.addEventListener("sideClick",()=>{console.log("PTT button pressed"),h()}),window.addEventListener("longPressStart",()=>{console.log("Long press started")}),window.addEventListener("longPressEnd",()=>{console.log("Long press ended")}),a&&a.addEventListener("click",()=>{m()})}function k(){typeof PluginMessageHandler>"u"&&(console.log("Setting up keyboard fallback for development"),window.addEventListener("keydown",t=>{switch(t.key){case"ArrowUp":t.preventDefault(),window.dispatchEvent(new CustomEvent("scrollUp"));break;case"ArrowDown":t.preventDefault(),window.dispatchEvent(new CustomEvent("scrollDown"));break;case"Enter":case" ":t.preventDefault(),window.dispatchEvent(new CustomEvent("sideClick"));break;case"Escape":t.preventDefault(),m();break}}))}window.onPluginMessage=function(t){if(console.log("Received plugin message:",t),t.data)try{const n=typeof t.data=="string"?JSON.parse(t.data):t.data;n.type==="songData"&&(e.currentSong=n.song,w())}catch(n){console.error("Error parsing message:",n)}};document.addEventListener("DOMContentLoaded",()=>{p()});console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation":"Running in browser mode - Use arrow keys and Enter for navigation");console.log("iPod Interface loaded!");console.log("======================");console.log("Controls:");console.log("- Scroll Wheel: Navigate up/down");console.log("- PTT Button: Select/Confirm");console.log("- Back: Return to previous menu");console.log("");console.log("Browser Testing:");console.log("- Arrow Up/Down: Navigate");console.log("- Enter/Space: Select");console.log("- Escape: Back");
